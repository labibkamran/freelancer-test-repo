<!DOCTYPE html>
<html lang="en" dir="ltr" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">

<!-- Breadcrumb Items -->
<th:block layout:fragment="breadcrumb-items">
    <wa-breadcrumb-item th:href="'/voucher/overview?tenantId=' + ${user.ctx.currentTenant?.id}">
        Vouchers
    </wa-breadcrumb-item>
    <wa-breadcrumb-item th:text="|${voucher.number}-${#temporals.format(voucher.date, 'yyyy')}|">
        Voucher
    </wa-breadcrumb-item>
</th:block>

<body>
<main layout:fragment="content">
    <div class="wa-container">
        <div class="wa-stack wa-gap-l">
            
            <!-- Voucher Header Section -->
            <wa-card>
                <div class="wa-stack wa-gap-m">
                    <div class="wa-split">
                        <h1 class="wa-heading-l">Voucher <span th:text="${voucher.getDisplayNumber()}" /></h1>
                        <wa-button size="small" variant="neutral" 
                                   th:onclick="'window.location.href=\'/voucher/overview?tenantId=' + ${user.ctx.currentTenant?.id} + '\''">
                            Back to Overview
                        </wa-button>
                    </div>
                    
                    <div class="wa-grid" style="grid-template-columns: repeat(2, 1fr);">
                        <div class="wa-stack wa-gap-xs">
                            <label class="wa-label" th:text="#{date}" />
                            <div class="wa-body-m" th:text="${#temporals.format(voucher.date, 'dd.MM.yyyy')}" />
                        </div>
                        <div class="wa-stack wa-gap-xs">
                            <label class="wa-label" th:text="#{description}" />
                            <div class="wa-body-m" th:text="${voucher.description ?: 'No description'}" />
                        </div>
                    </div>
                </div>
            </wa-card>

            <!-- Postings Section Card -->
            <wa-card>
                <div class="wa-stack wa-gap-m">
                    <h2 th:text="#{entries}" class="wa-heading-m" />
                    
                    <!-- Postings Table -->
                    <wa-table>
                        <table>
                            <thead>
                                <tr>
                                    <th th:text="#{account}" />
                                    <th th:text="#{description}" />
                                    <th th:text="#{amount}" style="text-align:right" />
                                    <th th:text="#{currency}" />
                                    <th th:text="#{vat_code}" />
                                    <th th:text="#{date}" />
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="posting : ${voucher.postings}">
                                    <td><strong th:text="${posting.accountNumber}"/></td>
                                    <td th:text="${posting.description ?: '-'}" />
                                    <td style="text-align:right">
                                        <span th:style="${posting.amount.compareTo(T(java.math.BigDecimal).ZERO) > 0 ? 'color: var(--wa-color-success-500);' : (posting.amount.compareTo(T(java.math.BigDecimal).ZERO) < 0 ? 'color: var(--wa-color-danger-500);' : '')}"
                                              th:text="${#numbers.formatDecimal(posting.amount, 1, 2)}" />
                                        <br th:if="${posting.originalCurrency != null}"/>
                                        <small th:if="${posting.originalCurrency != null}" class="wa-text-muted"
                                               th:text="|(${#numbers.formatDecimal(posting.originalAmount, 1, 2)} ${posting.originalCurrency})|" />
                                    </td>
                                    <td th:text="${posting.currency}" />
                                    <td>
                                        <wa-badge th:if="${posting.vatCode}" variant="neutral" th:text="${posting.vatCode}">25%</wa-badge>
                                        <span th:unless="${posting.vatCode}" class="wa-text-muted">-</span>
                                    </td>
                                    <td th:text="${#temporals.format(posting.postingDate, 'dd.MM.yyyy')}" />
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td colspan="4"></td>
                                    <th style="text-align:right" th:text="#{total_balance}" />
                                    <td style="text-align:right"
                                        th:with="totalBalance=${#aggregates.sum(voucher.postings.![amount])}"
                                        th:style="${totalBalance.compareTo(T(java.math.BigDecimal).ZERO) == 0 ? 'color: var(--wa-color-success-500);' : 'color: var(--wa-color-danger-500);'}"
                                        th:text="${#numbers.formatDecimal(totalBalance, 1, 2)} + ' NOK'" />
                                </tr>
                            </tfoot>
                        </table>
                    </wa-table>
                    
                </div>
            </wa-card>
            
        </div>
    </div>
</main>
</body>
</html> 