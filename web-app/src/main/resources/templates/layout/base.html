<!DOCTYPE html>
<html lang="en" dir="ltr" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${title != null ? title + ' - Reai' : 'Reai'}">Reai</title>

    <th:block th:replace="~{layout/libs :: common-libs}"></th:block>
    <link rel="stylesheet" th:href="@{/assets/base/base.css}">
    <!-- Custom head content -->
    <th:block layout:fragment="head"></th:block>
</head>
<body>
    <!-- Left Sidebar Navigation (only show if authenticated) -->
    <aside class="sidebar" id="sidebar" th:if="${user != null}">
        <div class="sidebar-header">
            <a href="/dashboard" class="sidebar-brand">
                üßÆ Accounting System
            </a>
            <button class="sidebar-toggle" onclick="toggleSidebar()">
                ‚úï
            </button>
        </div>
        <nav>
            <ul class="sidebar-menu">
                <!-- Dashboard -->
                <li class="menu-item">
                    <a href="/dashboard" class="menu-link" onclick="setActiveMenu(this)">
                        <span class="menu-icon">üè†</span>
                        <span class="menu-text">Home</span>
                    </a>
                </li>

                <!-- Vouchers (Accounting Documents) -->
                <li class="menu-item" th:if="${user.ctx.currentTenant != null}">
                    <button class="menu-link" onclick="toggleSubmenu(this)">
                        <span class="menu-icon">üìã</span>
                        <span class="menu-text">Vouchers</span>
                        <span class="menu-arrow">‚ñ∂</span>
                    </button>
                    <ul class="submenu">
                        <li><a th:href="'/voucher/new-advanced-voucher?tenantId=' + ${user.ctx.currentTenant.id}" class="menu-link">üìù Create Advanced Voucher</a></li>
                    </ul>
                </li>

                <!-- Chart of Accounts -->
                <li class="menu-item">
                    <button class="menu-link" onclick="toggleSubmenu(this)">
                        <span class="menu-icon">üìä</span>
                        <span class="menu-text">Accounts</span>
                        <span class="menu-arrow">‚ñ∂</span>
                    </button>
                    <ul class="submenu">
                        <li><a href="#" class="menu-link">‚öñÔ∏è Trial Balance</a></li>
                    </ul>
                </li>

                <!-- Chart of Accounts -->
                <li class="menu-item" th:if="${user.ctx.currentTenant != null}">
                    <button class="menu-link" onclick="toggleSubmenu(this)">
                        <span class="menu-icon">üë•</span>
                        <span class="menu-text">Customer</span>
                        <span class="menu-arrow">‚ñ∂</span>
                    </button>
                    <ul class="submenu">
                        <li><a th:href="'/customer?tenantId=' + ${user.ctx.currentTenant.id}" class="menu-link">üìã Customers/Suppliers</a></li>
                        <li><a th:href="'/customer/new?tenantId=' + ${user.ctx.currentTenant.id}" class="menu-link">üÜï New Customer/Supplier</a></li>
                    </ul>
                </li>
            </ul>
        </nav>
    </aside>

    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

    <!-- Main Content Wrapper - Only for authenticated users -->
    <div class="main-wrapper" id="mainWrapper" th:if="${user != null}">
        <!-- Top Navigation (only show if authenticated) -->
        <nav class="navbar" th:if="${user != null}">
            <div class="container">
                <div class="d-flex justify-content-between align-items-center w-100">
                    <!-- Left Side: Mobile Menu Toggle + Company Selector -->
                    <div class="d-flex align-items-center">
                        <!-- Mobile Menu Toggle -->
                        <button class="mobile-menu-toggle sidebar-toggle" onclick="openSidebar()" style="background: none; border: none; color: white; font-size: 1.25rem; margin-right: 1rem;">
                            ‚ò∞
                        </button>

                        <!-- Desktop Sidebar Toggle -->
                        <button class="desktop-sidebar-toggle sidebar-toggle" onclick="toggleSidebar()" style="background: none; border: none; color: white; font-size: 1.25rem; margin-right: 1rem; display: none;">
                            ‚ò∞
                        </button>

                        <!-- Company Selector Dropdown -->
                        <wa-dropdown placement="bottom-start" hoist>
                            <wa-button slot="trigger" size="small" appearance="filled outlined" variant="neutral" pill>
                                <wa-icon name="buildings" style="margin-right: 0.5rem;"></wa-icon>
                                <span th:text="${currentCompany != null ? currentCompany.name : 'Select Company'}">Select Company</span>
                                <wa-icon name="chevron-down" style="margin-left: 0.5rem;"></wa-icon>
                            </wa-button>

                            <wa-menu>
                                <wa-menu-item th:each="company : ${companies}"
                                             th:onclick="'switchCompany(' + ${company.tenantId} + ')'"
                                             th:class="${currentCompany != null and currentCompany.tenantId == company.tenantId} ? 'selected' : ''">
                                    <wa-icon name="building" style="margin-right: 0.5rem;"></wa-icon>
                                    <span th:text="${company.name}">Company Name</span>
                                </wa-menu-item>

                                <wa-divider></wa-divider>

                                <wa-menu-item onclick="window.open('/companies/create', '_blank')">
                                    <wa-icon name="plus"></wa-icon>
                                    <span>Create New Company</span>
                                </wa-menu-item>
                            </wa-menu>
                        </wa-dropdown>
                    </div>

                    <!-- Right Side: User Account Dropdown -->
                    <div class="d-flex align-items-center">
                        <wa-dropdown placement="bottom-end">
                            <wa-button slot="trigger" size="small" appearance="filled outlined" variant="neutral" pill>
                                <wa-icon slot="prefix" name="user" variant="solid"></wa-icon>
                                <th:block th:text="${user.username}"></th:block>
                            </wa-button>
                            <wa-menu>
                                <wa-menu-item onclick="window.location.href='/auth/logout'">Logout</wa-menu-item>
                            </wa-menu>
                        </wa-dropdown>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main layout:fragment="content">
            <!-- Page content will be inserted here -->
        </main>

        <!-- Footer -->
        <footer style="background: #f8f9fa; padding: 2rem 0; margin-top: 3rem;" th:if="${user != null}">
            <div class="container text-center">
                <p class="text-muted mb-0">
                    ¬© 2025 - Accounting System
                </p>
            </div>
        </footer>
    </div>

    <!-- Auth Content Wrapper - Only for non-authenticated users -->
    <div class="auth-wrapper" th:if="${user == null}">
        <!-- Main Content -->
        <main layout:fragment="content">
            <!-- Page content will be inserted here -->
        </main>
    </div>

    <!-- Custom JS -->
    <script th:src="@{/assets/base/base.js}"></script>

    <!-- Custom scripts -->
    <th:block layout:fragment="scripts"></th:block>
</body>
</html> 