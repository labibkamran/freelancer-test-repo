<tr class="posting-line-row" 
    th:id="'posting-line-row-' + ${rowCounter}"
    xmlns:th="http://www.thymeleaf.org"
    th:fragment="posting-line-row">
    <td>
        <wa-input type="date"
               size="small"
               th:value="${initialDate}"
               th:name="'postingLines[' + ${rowCounter} + '].postingDate'">
        </wa-input>
    </td>
    <td>
        <div style="display: flex; flex-direction: column; gap: 2px;">
            <select th:name="'postingLines[' + ${rowCounter} + '].debitAccount'"
                    class="form-control"
                    style="font-size: 0.8rem;">
                <option value="">Select debit account...</option>
                <option th:each="account : ${accounts}" 
                        th:value="${account.noAccountNumber}"
                        th:text="${account.noAccountNumber + ' - ' + account.accountName}">
                </option>
            </select>
            
            <select th:name="'postingLines[' + ${rowCounter} + '].debitVatCode'"
                    class="form-control"
                    style="font-size: 0.75rem;">
                <option value="0">Select VAT code...</option>
                <option th:each="vatCode : ${vatCodes}" 
                        th:value="${vatCode.code}"
                        th:text="${vatCode.code + ' (' + vatCode.rate + '%) - ' + vatCode.description}">
                </option>
            </select>
        </div>
    </td>
    <td>
        <div style="display: flex; flex-direction: column; gap: 2px;">
            <select th:name="'postingLines[' + ${rowCounter} + '].creditAccount'"
                    class="form-control"
                    style="font-size: 0.8rem;">
                <option value="">Select credit account...</option>
                <option th:each="account : ${accounts}" 
                        th:value="${account.noAccountNumber}"
                        th:text="${account.noAccountNumber + ' - ' + account.accountName}">
                </option>
            </select>
            
            <select th:name="'postingLines[' + ${rowCounter} + '].creditVatCode'"
                    class="form-control"
                    style="font-size: 0.75rem;">
                <option value="0">Select VAT code...</option>
                <option th:each="vatCode : ${vatCodes}" 
                        th:value="${vatCode.code}"
                        th:text="${vatCode.code + ' (' + vatCode.rate + '%) - ' + vatCode.description}">
                </option>
            </select>
        </div>
    </td>
    <td>
        <div style="position: relative;">
            <wa-input type="number"
                   th:name="'postingLines[' + ${rowCounter} + '].amount'"
                   th:id="'posting-lines-amount-' + ${rowCounter}"
                   min="0"
                   step="0.01"
                   placeholder="Amount"
                   th:attr="hx-get=@{/htmx/currency/convert(toCurrency=${companyCurrencyCode})},
                            hx-trigger='change, keyup delay:500ms',
                            hx-target=|#converted-amount-${rowCounter}|,
                            hx-swap='innerHTML',
                            hx-include=|#posting-lines-amount-${rowCounter}, #posting-lines-currency-${rowCounter}|"></wa-input>
            <div th:id="'converted-amount-' + ${rowCounter}" class="converted-amount-display"></div>
        </div>
    </td>
    <td>
        <wa-select th:name="'postingLines[' + ${rowCounter} + '].currency'"
                   th:id="'posting-lines-currency-' + ${rowCounter}"
                   th:attr="hx-get=@{/htmx/currency/convert(toCurrency=${companyCurrencyCode})},
                            hx-trigger='change',
                            hx-target=|#converted-amount-${rowCounter}|,
                            hx-swap='innerHTML',
                            hx-include=|#posting-lines-amount-${rowCounter}, #posting-lines-currency-${rowCounter}|">
            <wa-option
                th:each="currency : ${supportedCurrencies}"
                th:value="${currency}"
                th:text="${currency}"
                th:selected="${currency == companyCurrencyCode}"
            ></wa-option>
        </wa-select>
    </td>
    <td>
        <wa-input type="text"
               size="small"
               placeholder="Description"
               th:name="'postingLines[' + ${rowCounter} + '].description'">
        </wa-input>
    </td>
    <td>
        <wa-button type="button" 
                   size="small" 
                   variant="danger"
                   onclick="removePostingLine(this)">
            <wa-icon label="Remove posting row" name="trash"></wa-icon>
        </wa-button>
    </td>
</tr> 